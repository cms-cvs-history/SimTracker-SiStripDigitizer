process PRODTWO  = {
	untracked PSet options = {
//include "FWCore/Framework/test/cmsExceptionsFatalOption.cff"
//untracked bool wantSummary =  false
	untracked bool makeTriggerResults =  true
	}

   # initialize MessageLogger
   include "FWCore/MessageLogger/data/MessageLogger.cfi"



   service = RandomNumberGeneratorService
   {
      untracked uint32 sourceSeed = 2387
      PSet moduleSeeds =
      {
         untracked uint32 VtxSmeared = 92
         untracked uint32 g4SimHits = 193
	 untracked uint32 mix = 333
      }
   }

   es_module = TrackerGeometricDetESModule {}
   es_module = TrackerDigiGeometryESModule {}

   ############ Access to ORCOFF via Frontier ############
   es_source = PoolDBESSource {

#TIB    VPSet toGet = {
#TIB      { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TIB_v1_p"},
#TIB      { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIB_v1_n"},
#TIB      { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIB_v1"}
#TIB    }
#TOB    VPSet toGet = {
#TOB      { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TOB_v1_p"},
#TOB      { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TOB_v1_n"},
#TOB      { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TOB_v1"}
#TOB    }
#TIBTOB    VPSet toGet = {
#TIBTOB      { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TIBTOB_v1_p"},
#TIBTOB      { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIBTOB_v1_n"},
#TIBTOB      { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIBTOB_v1"}
#TIBTOB    }
     VPSet toGet = {
       { string record = "SiStripPedestalsRcd" string tag = "SiStripPedNoise_TIF_v1_p"},
       { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIF_v1_n"},
       { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIF_v1"}
     }
   
     untracked bool siteLocalConfig = true
     string connect = "frontier://cms_conditions_data/CMS_COND_STRIP"
     string timetype = "runnumber"

   PSet DBParameters ={
     untracked string authenticationPath = ""
     untracked bool loadBlobStreamer = true
  }
}

# produce SiStripFecCabling and SiStripDetCabling out of SiStripFedCabling
es_module sistripconn = SiStripConnectivity {}

   include "SimGeneral/HepPDTESSource/data/pdt.cfi"

   ####################################################################
   ## Source files,                                                  ##
   ## use PoolSource for EDM files and TBRUInputSource for RAW files ##
   ####################################################################
   source = PoolSource {
     untracked vstring fileNames = {
       "file:Dropped_Sim_1.root",
       "file:Dropped_Sim_2.root"
     }
     # untracked uint32 skipEvents = 0
     untracked int32 maxEvents = -1
   }
   ////////////////////////////////////////////////////////////////////

#Filtering

	 module fil = CosmicTIFFilter
	 {
           bool filter = true
         }

	 module fil_gen = CosmicGenFilterLowGeV
	  {
	    bool filter = true
	  }


 es_source = EmptyESSource {
    string recordName     = "IdealMagneticFieldRecord"
    bool iovIsRunNotTime  = true
    vuint32 firstValid    = {1}
 }

 es_module = UniformMagneticFieldESProducer {
  double ZFieldInTesla = 0.0
 }

 es_prefer = UniformMagneticFieldESProducer{}
 
 include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
 #include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
# include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
# include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

# SIMULATION
 include "SimG4Core/Application/data/g4SimHits.cfi"
 replace g4SimHits.Generator.HepMCProductLabel  = "source"
 replace g4SimHits.NonBeamEvent                 = true       
 replace g4SimHits.UseMagneticField             = false
 replace g4SimHits.TrackerSD =       {
        bool    ZeroEnergyLoss = false
        bool    NeverAccumulate = false
        bool    PrintHits = false
        double  ElectronicSigmaInNanoSeconds = 12.06
        double  EnergyThresholdForPersistencyInGeV = 0.2
        double  EnergyThresholdForHistoryInGeV = 0.2
     }

 module mix = MixingModule
  {        
   int32 bunchspace = 25
  }   


#DIGITIZATION
# include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
 include "SimTracker/SiStripDigitizer/data/SiStripDigiMTCC.cfi"
   replace siStripDigis.NoNoise          = false
   replace siStripDigis.ElectronPerAdc   = 250.0
   replace siStripDigis.CouplingCostant  = {0.86,0.07}
   replace siStripDigis.PeakMode         = true
   replace siStripDigis.ConfFromDB       = true

#CLUSTER
 include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_SimData.cfi"    
  replace siStripClusters.ElectronPerAdc      = 250.0
  replace siStripClusters.ChannelThreshold    = 2.0
  replace siStripClusters.SeedThreshold       = 3.0
  replace siStripClusters.ClusterThreshold    = 5.0
#  replace siStripClusters.UseCalibDataFromDB  = false




#RECHIT
 include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
 include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
 include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"

  # Tracking Truth
  include "SimGeneral/TrackingAnalysis/data/trackingtruth.cfi"
  replace trackingtruth.HepMCDataLabels = {"source"}

  # Track Associators
  include "SimTracker/TrackAssociation/data/TrackAssociatorByChi2.cfi"
  include "SimTracker/TrackAssociation/data/TrackAssociatorByHits.cfi"




   path p1 = {
#	g4SimHits,
#	fil_gen,
#	fil,
	mix,
        trackingtruth,
        siStripDigis
	, siStripClusters
	, siStripMatchedRecHits
	}


   module TheTIF = PoolOutputModule
   {
      string psethack = "test2_withoutservices"
      untracked string fileName = "Cosmic_base.root"
      untracked PSet SelectEvents ={
        vstring SelectEvents = {"p1"}
      } 

   }

   endpath outpath = { TheTIF }

}

